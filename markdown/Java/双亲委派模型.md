**<font color='red'>ã€ŒJVM ç±»åŠ è½½å­ç³»ç»Ÿã€ç³»åˆ—æ–‡ç« </font>**

- **[ç±»åŠ è½½çš„è¿‡ç¨‹](./ç±»åŠ è½½çš„è¿‡ç¨‹.html)**
- **[ç±»åŠ è½½çš„æ—¶æœº](./ç±»åŠ è½½çš„æ—¶æœº.html)**
- **[ç±»åŠ è½½å™¨](./ç±»åŠ è½½å™¨.html)**
- **[å‰–æ [Bootstrapã€Extensionã€Application] ClassLoader](./å‰–æ-Bootstrap-Extension-Application-ClassLoader.html)**
- **[â¤ï¸â€ğŸ”¥ åŒäº²å§”æ´¾æ¨¡å‹](./åŒäº²å§”æ´¾æ¨¡å‹.html)**
- **[è‡ªå®šä¹‰ç±»åŠ è½½å™¨](./è‡ªå®šä¹‰ç±»åŠ è½½å™¨.html)**
- **[ç ´ååŒäº²å§”æ´¾æ¨¡å‹](./ç ´ååŒäº²å§”æ´¾æ¨¡å‹.html)**

# åŒäº²å§”æ´¾æ¨¡å‹

### <font color=#1FA774>å‰è¨€</font>

åœ¨æ­£å¼ä»‹ç»åŒäº²å§”æ´¾æ¨¡å‹ä¹‹å‰ï¼Œè¦æ€è€ƒä¸¤ä¸ªé—®é¢˜ï¼Œ**<font color='red'>ä¸ºä»€ä¹ˆè¦ç ”ç©¶ç±»åŠ è½½çš„è¿‡ç¨‹ï¼Ÿä¸ºä»€ä¹ˆè¦ç ”ç©¶åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ</font>**

ç ”ç©¶ç±»åŠ è½½çš„è¿‡ç¨‹æ˜¯ä¸ºäº†çŸ¥é“åŠ è½½è¿‡ç¨‹ä½¿ç”¨åˆ°äº†åŒäº²å§”æ´¾æ¨¡å‹ï¼Œä½†ä»…ä»…çŸ¥é“ä½¿ç”¨äº†åŒäº²å§”æ´¾æ¨¡å‹è¿˜ä¸å¤Ÿï¼Œæœ€ç»ˆç›®çš„æ˜¯è¦å¼„æ¸…æ¥šä¸ºä»€ä¹ˆè¦ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿï¼åŒäº²å§”æ´¾æ¨¡å‹çš„åŸç†ï¼Ÿï¼åŒäº²å§”æ´¾æ¨¡å‹èƒŒåçš„é€»è¾‘æ€æƒ³ï¼Ÿï¼è¯¥æ€æƒ³æ˜¯å¦å¯ä»¥è¢«æˆ‘ä»¬å€Ÿé‰´ï¼Œä¸ºæˆ‘æ‰€ç”¨ï¼Ÿï¼

**æ¯”å¦‚ï¼š**åŒäº²å§”æ´¾æ¨¡å‹é¿å…äº†ç±»çš„é‡å¤åŠ è½½ï¼Œé¿å…äº†æ ¸å¿ƒç±»åº“è¢«ä¿®æ”¹ã€‚é‚£ä¹ˆæˆ‘ä»¬åœ¨è®¾è®¡æ¡†æ¶æ—¶ï¼Œæ¡†æ¶åº•å±‚çš„å†…å®¹è¦ä¸å®¹æ˜“è¢«ç¯¡æ”¹ï¼Œæˆ–è€…ä¸è¢«æ”»å‡»ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥å€Ÿé‰´åŒäº²å§”æ´¾æ¨¡å‹ï¼ï¼

### <font color=#1FA774>æ¦‚å¿µ</font>

é€šè¿‡ä¸Šä¸€éƒ¨åˆ†è¾“å‡ºçš„æ–‡ä»¶ç›®å½•å¯ä»¥çœ‹å‡ºï¼Œã€Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€åŠ è½½çš„æ–‡ä»¶åŒ…å«äº†ã€Œå¯åŠ¨ç±»åŠ è½½å™¨ã€åŠ è½½çš„æ–‡ä»¶å’Œã€Œæ‰©å±•ç±»åŠ è½½å™¨ã€åŠ è½½çš„æ–‡ä»¶ï¼Œé‚£è¿™æ˜¯ä¸æ˜¯æ„å‘³ç€é‡å¤åŠ è½½äº†å‘¢ï¼Ÿï¼

å…¶å®ä¸ç„¶ï¼Œæ ¹æ®å‰æ–‡ **[ç±»åŠ è½½å™¨](./ç±»åŠ è½½å™¨.html)** çš„ä»‹ç»ã€Œåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€ä¸»è¦è´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ (ClassPath) ä¸Šæ‰€æœ‰çš„ç±»åº“ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”è¾“å‡ºä¸­çš„`../../../../concurrency/target/classes`

ä¹‹æ‰€ä»¥ä¸ä¼šé‡å¤åŠ è½½ï¼Œå®Œå…¨æ˜¯å› ä¸ºåŒäº²å§”æ´¾æ¨¡å‹ï¼Œå®ƒåˆ†ä¸ºä¸¤ä¸ªè¿‡ç¨‹ï¼š

- **å‘ä¸Šå§”æ‰˜æŸ¥æ‰¾**
- **å‘ä¸‹åŠ è½½**

![6](https://cdn.jsdelivr.net/gh/LFool/image-hosting@master/20221027/15043416668542749OFpuo6.svg)

**<font color='red'>æ³¨æ„ï¼š</font>**åŒäº²å§”æ´¾æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ã€‚ä¸è¿‡è¿™é‡Œç±»åŠ è½½å™¨ä¹‹é—´çš„çˆ¶å­å…³ç³»ä¸€èˆ¬ä¸æ˜¯ç»§æ‰¿æ¥å®ç°çš„ï¼Œè€Œæ˜¯**é€šå¸¸ä½¿ç”¨ç»„åˆå…³ç³»æ¥å¤ç”¨çˆ¶åŠ è½½å™¨çš„ä»£ç **

**<font color='red'>å·¥ä½œè¿‡ç¨‹ï¼š</font>**å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œæ¯ä¸€ä¸ªå±‚æ¬¡çš„ç±»åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œå› æ­¤æ‰€æœ‰çš„åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ åˆ°æœ€é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚ (å®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±») æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»å®ŒæˆåŠ è½½

### <font color=#1FA774>å¥½å¤„</font>

**<font color='red'>1. å¯ä»¥é¿å…ç±»é‡å¤åŠ è½½</font>**

- ç°åœ¨æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ¯æ¬¡åŠ è½½ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œéƒ½ä¼šä»åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨å¼€å§‹å‘ä¸Šå§”æ‰˜ï¼Œç„¶åå‘ä¸‹åŠ è½½ï¼Œè¿™æ ·å²‚ä¸æ˜¯å¤šæ­¤ä¸€ä¸¾ï¼Ÿï¼Ÿï¼ï¼

- å…¶å®ä¸ç„¶ï¼Œæ¯ä¸ªç±»åªæœ‰ç¬¬ä¸€æ¬¡ä½¿ç”¨çš„æ—¶å€™ä¼šè¿™æ ·åŠ è½½ï¼Œå½“å†æ¬¡ä½¿ç”¨æ—¶ï¼Œå‘ç°å·²ç»è¢«åŠ è½½è¿‡äº†ï¼Œå°±ä¼šç›´æ¥ä»åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ä¸­å»è·å¾—è¯¥ç±»ï¼Œ**<font color='red'>å¯ä»¥é¿å…ç±»é‡å¤åŠ è½½</font>**

**<font color='red'>2. å¯ä»¥é˜²æ­¢æ ¸å¿ƒ API åº“è¢«éšæ„ä¿®æ”¹</font>**

- ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹æ¥ç»„ç»‡ç±»åŠ è½½å™¨ä¹‹é—´çš„å…³ç³»ï¼Œä¸€ä¸ªæ˜¾è€Œæ˜“è§çš„**å¥½å¤„**å°±æ˜¯ Java ä¸­çš„ç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·å¤‡äº†ä¸€ç§å¸¦æœ‰**ä¼˜å…ˆçº§**çš„å±‚æ¬¡å…³ç³»ï¼Œ**<font color='red'>å¯ä»¥é˜²æ­¢æ ¸å¿ƒ API åº“è¢«éšæ„ä¿®æ”¹</font>**

- **ä¾‹å¦‚ï¼š**`java.lang.Object`ï¼Œå®ƒå­˜æ”¾åœ¨`rt.jar`ä¹‹ä¸­ï¼Œæ— è®ºå“ªä¸€ä¸ªç±»åŠ è½½å™¨è¦åŠ è½½è¿™ä¸ªç±»ï¼Œæœ€ç»ˆéƒ½æ˜¯å§”æ´¾ç»™å¤„äºæ¨¡å‹æœ€é¡¶ç«¯çš„å¯åŠ¨ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œå› æ­¤`Object`ç±»åœ¨ç¨‹åºçš„å„ç§ç±»åŠ è½½å™¨ç¯å¢ƒä¸­éƒ½èƒ½å¤Ÿä¿è¯æ˜¯åŒä¸€ä¸ªç±»ã€‚åä¹‹ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹ï¼Œéƒ½ç”±å„ä¸ªç±»åŠ è½½å™¨è‡ªè¡Œå»åŠ è½½çš„è¯ï¼Œå¦‚æœç”¨æˆ·è‡ªå·±ä¹Ÿç¼–å†™äº†ä¸€ä¸ªåä¸º`java.lang.Object`çš„ç±»ï¼Œå¹¶æ”¾åœ¨ç¨‹åºçš„`ClassPath`ä¸­ï¼Œé‚£ç³»ç»Ÿä¸­å°±ä¼šå‡ºç°å¤šä¸ªä¸åŒçš„`Object`ç±»ï¼ŒJava ç±»å‹ä½“ç³»ä¸­æœ€åŸºç¡€çš„è¡Œä¸ºä¹Ÿå°±æ— ä»ä¿è¯ï¼Œåº”ç”¨ç¨‹åºå°†å˜å¾—ä¸€ç‰‡æ··ä¹±

- å‡è®¾æˆ‘ä»¬å°è¯•å»ç¼–å†™ä¸€ä¸ªå’Œ`rt.jar`ç±»åº“ä¸­å·²æœ‰ç±»é‡åçš„ Java ç±»ï¼Œå°†ä¼šå‘ç°å®ƒ**å¯ä»¥æ­£å¸¸ç¼–è¯‘**ï¼Œä½†**æ°¸è¿œæ— æ³•è¢«åŠ è½½è¿è¡Œ**

**<font color='red'>3. å…¨ç›˜å§”æ‰˜æœºåˆ¶</font>**

- å½“ä¸€ä¸ªç±»æ²¡æœ‰æŒ‡å®šç±»åŠ è½½å™¨ï¼Œä¼šé»˜è®¤ä½¿ç”¨ AppClassLoaderï¼Œå½“ä¸€ä¸ªç±»ä¸­è°ƒç”¨å¦å¤–ä¸€ä¸ªæœªè¢«åŠ è½½çš„ç±»æ—¶ï¼Œä¼šé»˜è®¤å§”æ‰˜å½“å‰ç±»çš„ç±»åŠ è½½å™¨
- æ›´å®˜æ–¹çš„æ¥è¯´ï¼šå½“ä¸€ä¸ª ClassLoader è£…è½½ä¸€ä¸ªç±»æ—¶ï¼Œé™¤éæ˜¾ç¤ºåœ°ä½¿ç”¨å¦ä¸€ä¸ª ClassLoaderï¼Œåˆ™è¯¥ç±»æ‰€ä¾èµ–åŠå¼•ç”¨çš„ç±»ä¹Ÿç”±è¿™ä¸ª CladdLoader è½½å…¥

### <font color=#1FA774>æºç åˆ†æ</font>

**å…³äºä¸‰ä¸ªç±»åŠ è½½å™¨çš„æºç åˆ†æå¯è§ [å‰–æ [Bootstrapã€Extensionã€Application] ClassLoader](./å‰–æ-Bootstrap-Extension-Application-ClassLoader.html)**

![133](https://cdn.jsdelivr.net/gh/LFool/image-hosting@master/20221026/0003221666713802MIwUJF133.svg)

C++ è¯­è¨€è°ƒç”¨äº†`sun.misc.Launcher.getLauncher()`è·å–äº† launcher å¯¹è±¡ï¼ŒLauncher ç±»åˆå§‹åŒ–çš„æ—¶å€™å…¶æ„é€ å™¨åˆ›å»ºäº† ExtClassLoader å’Œ AppClassLoaderï¼Œç„¶åæ¥ä¸‹æ¥è°ƒç”¨ launcher å¯¹è±¡çš„`getClassLoader()`æ–¹æ³•

```java
public ClassLoader getClassLoader() {
    return loader;
}
```

è°ƒç”¨`getClassLoader()`æ–¹æ³•è·å¾—äº†`loader`å¯¹è±¡ï¼Œè€Œ`loader`å¯¹è±¡åœ¨æ„é€ å‡½æ•°ä¸­è¢«èµ‹å€¼

```java
public Launcher() {
    // Create the extension class loader
    ClassLoader extcl;
    try {
        // è·å–æ‰©å±•ç±»åŠ è½½å™¨ï¼ŒgetExtClassLoader() è§ä¸‹æ–¹
        extcl = ExtClassLoader.getExtClassLoader();
    } catch (IOException e) {
        throw new InternalError(
            "Could not create extension class loader", e);
    }
    // Now create the class loader to use to launch the application
    try {
        // è·å–åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨
        loader = AppClassLoader.getAppClassLoader(extcl);
    } catch (IOException e) {
        throw new InternalError(
            "Could not create application class loader", e);
    }
    // çœç•¥å…¶å®ƒä»£ç  ...
}
```

ç±»åŠ è½½å™¨é€šè¿‡è°ƒç”¨`loader.loadClass("com.lfool.My")`æ¥åŠ è½½ç±»ï¼Œæ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œå¯ä»¥çŸ¥é“åŒäº²å§”æ´¾æ¨¡å‹çš„èµ·ç‚¹æ˜¯`AppClassLoader`ï¼Œä¹Ÿæ­£å¦‚å‰æ–‡ **[ç±»åŠ è½½å™¨](./ç±»åŠ è½½å™¨.html)** æ‰€è¯´ï¼šå¦‚æœåº”ç”¨ä¸­æ²¡æœ‰è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨çš„å°±æ˜¯ AppClassLoader ä½œä¸ºé»˜è®¤ç±»åŠ è½½å™¨

ä¸‹å›¾åˆ†åˆ«æ˜¯ AppClassLoader å’Œ ExtClassLoader çš„å…³ç³»å›¾ (IDEA å¿«æ·é”®ï¼šOption + Command + U)

![66](https://cdn.jsdelivr.net/gh/LFool/image-hosting@master/20221027/2019491666873189fUTFnP66.svg)

**<font color='red'>å‘ä¸Šå§”æ‰˜æŸ¥æ‰¾ï¼Œå‘ä¸‹åŠ è½½</font>**

```java
// AppClassLoader ç±»
public Class<?> loadClass(String name, boolean resolve)
    throws ClassNotFoundException
{
    int i = name.lastIndexOf('.');
    if (i != -1) {
        SecurityManager sm = System.getSecurityManager();
        if (sm != null) {
            sm.checkPackageAccess(name.substring(0, i));
        }
    }
    // å¦‚æœç±»å·²ç»åŠ è½½
    if (ucp.knownToNotExist(name)) {
        Class<?> c = findLoadedClass(name);
        if (c != null) {
            if (resolve) {
                resolveClass(c);
            }
            return c;
        }
        throw new ClassNotFoundException(name);
    }
    // å¦‚æœç±»æ²¡æœ‰è¢«åŠ è½½ï¼Œè°ƒç”¨çˆ¶ç±»çš„ loadClass() æ–¹æ³•
    // AppClassLoader çš„çˆ¶ç±»æ˜¯ URLClassLoaderï¼Œä½†æ˜¯ URLClassLoader ä¸­æ²¡æœ‰ loadClass() æ–¹æ³•
    // ç»§ç»­å¾€ä¸Šçœ‹ï¼ŒURLClassLoader çš„çˆ¶ç±»æ˜¯ ClassLoaderï¼Œæœ‰ loadClass() æ–¹æ³•
    // æ‰€ä»¥ æ­¤å¤„è°ƒç”¨çš„æ˜¯ ClassLoader ä¸­çš„ loadClass() æ–¹æ³•ï¼Œå…·ä½“è§ä¸‹æ–¹
    return (super.loadClass(name, resolve));
}
// ClassLoader ç±»
protected Class<?> loadClass(String name, boolean resolve)
        throws ClassNotFoundException
{
    // synchronized åŒæ­¥é”ï¼Œæ‰€ä»¥ç±»åŠ è½½æ˜¯çº¿ç¨‹å®‰å…¨çš„
    synchronized (getClassLoadingLock(name)) {
        // é¦–å…ˆï¼Œæ£€æŸ¥è¯·æ±‚çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡äº†
        Class<?> c = findLoadedClass(name);
        if (c == null) {
            long t0 = System.nanoTime();
            try {
                if (parent != null) {                     // çˆ¶ç±»åŠ è½½å™¨ä¸ä¸º nullï¼Œå§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨åŠ è½½
                    c = parent.loadClass(name, false);
                } else {                                  // çˆ¶ç±»åŠ è½½å™¨ä¸º nullï¼Œå§”æ‰˜ç»™å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½
                    c = findBootstrapClassOrNull(name);
                }
            } catch (ClassNotFoundException e) {
                // å¦‚æœçˆ¶ç±»åŠ è½½å™¨æŠ›å‡º ClassNotFoundException
                // è¯´æ˜çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®ŒæˆåŠ è½½è¯·æ±‚
            }
            
            // åˆ°è¿™ä¸€æ­¥ c è¿˜ä¸º nullï¼Œè¡¨ç¤ºçˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½è¯¥ç±»
            if (c == null) {
                // åœ¨çˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½æ—¶ï¼Œå†è°ƒç”¨æœ¬èº«çš„ findClass æ–¹æ³•æ¥è¿›è¡Œç±»åŠ è½½
                long t1 = System.nanoTime();
                // ç”±äº ClassLoader ç±»ä¸­ findClass æ˜¯ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œéœ€è¦å›åˆ°å®ç°äº†è¯¥æ–¹æ³•çš„ç±»ä¸­æ‰¾ï¼Œå›åˆ° URLClassLoader ä¸­ï¼Œå…·ä½“è§ä¸‹æ–¹
                c = findClass(name);

                // this is the defining class loader; record the stats
                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 - t0);
                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);
                sun.misc.PerfCounter.getFindClasses().increment();
            }
        }
        if (resolve) {
            resolveClass(c);
        }
        return c;
    }
}
// URLClassLoader ç±»
// æ ¹æ®ä½ç½®å’Œåç§°åŠ è½½ class å­—èŠ‚ç 
protected Class<?> findClass(final String name)
    throws ClassNotFoundException
{
    final Class<?> result;
    try {
        // doPrivileged æ˜¯ä¸€ä¸ªæƒé™æ ¡éªŒçš„æ“ä½œï¼Œå¯ä»¥å…ˆä¸ç®¡
        result = AccessController.doPrivileged(
            new PrivilegedExceptionAction<Class<?>>() {
                public Class<?> run() throws ClassNotFoundException {
                    // com.lfool.My -> com/lfool/My.classï¼Œã€Œå…¨é™å®šç±»åã€è½¬åŒ–æˆã€Œç±»è·¯å¾„ã€
                    String path = name.replace('.', '/').concat(".class");
                    // å» resource åº“ä¸­æ‰¾è¿™ä¸ªè·¯å¾„ï¼Œæ²¡æœ‰å°±è¿”å› null
                    Resource res = ucp.getResource(path, false);
                    if (res != null) {
                        try {
                            // æ‰¾åˆ°äº†ï¼Œå¼€å§‹æ‰§è¡ŒåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–ï¼Œå…·ä½“è§ä¸‹æ–¹
                            return defineClass(name, res);
                        } catch (IOException e) {
                            throw new ClassNotFoundException(name, e);
                        } catch (ClassFormatError e2) {
                            if (res.getDataError() != null) {
                                e2.addSuppressed(res.getDataError());
                            }
                            throw e2;
                        }
                    } else {
                        return null;
                    }
                }
            }, acc);
    } catch (java.security.PrivilegedActionException pae) {
        throw (ClassNotFoundException) pae.getException();
    }
    if (result == null) {
        throw new ClassNotFoundException(name);
    }
    return result;
}
// å°†å­—èŠ‚ç è½¬åŒ–ä¸º Class å¯¹è±¡
private Class<?> defineClass(String name, Resource res) throws IOException {
    long t0 = System.nanoTime();
    int i = name.lastIndexOf('.');
    // è·å– classes ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œå¦‚ï¼šfile:/Users/lfool/myself/IdeaProjects/concurrency/target/classes
    URL url = res.getCodeSourceURL();
    if (i != -1) {
        // è·å–åŒ…å
        String pkgname = name.substring(0, i);
        // Check if package already loaded.
        Manifest man = res.getManifest();
        definePackageInternal(pkgname, man, url);
    }
    // è¯»å…¥ class çš„å­—èŠ‚æµ
    java.nio.ByteBuffer bb = res.getByteBuffer();
    if (bb != null) {
        // Use (direct) ByteBuffer:
        CodeSigner[] signers = res.getCodeSigners();
        CodeSource cs = new CodeSource(url, signers);
        sun.misc.PerfCounter.getReadClassBytesTime().addElapsedTimeFrom(t0);
        return defineClass(name, bb, cs);
    } else {
        byte[] b = res.getBytes();
        // must read certificates AFTER reading bytes.
        CodeSigner[] signers = res.getCodeSigners();
        CodeSource cs = new CodeSource(url, signers);
        sun.misc.PerfCounter.getReadClassBytesTime().addElapsedTimeFrom(t0);
        // è§ä¸‹æ–¹
        return defineClass(name, b, 0, b.length, cs);
    }
}
// ClassLoader ç±»
// é€šå¸¸æ˜¯ä¸€äº›åŸºç¡€çš„æ ¡éªŒï¼Œæ¯”å¦‚å‡†å¤‡é˜¶æ®µï¼Œè§£æé˜¶æ®µï¼Œåˆå§‹åŒ–é˜¶æ®µéƒ½æ˜¯æœ¬åœ°æ–¹æ³•
protected final Class<?> defineClass(String name, byte[] b, int off, int len,
                                     ProtectionDomain protectionDomain)
    throws ClassFormatError
{
    // é¢„å®šä¹‰ç±»ä¿¡æ¯
    protectionDomain = preDefineClass(name, protectionDomain);
    // å®šä¹‰ç±»æºç 
    String source = defineClassSourceLocation(protectionDomain);
    // åˆå§‹åŒ–ç±»ï¼Œè°ƒç”¨æœ¬åœ°æ–¹æ³•
    Class<?> c = defineClass1(name, b, off, len, protectionDomain, source);
    // ç±»å®šä¹‰åç½®å¤„ç†
    postDefineClass(c, protectionDomain);
    return c;
}
```