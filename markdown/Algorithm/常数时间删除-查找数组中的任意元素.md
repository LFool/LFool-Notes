# å¸¸æ•°æ—¶é—´åˆ é™¤-æŸ¥æ‰¾æ•°ç»„ä¸­çš„ä»»æ„å…ƒç´ 

[380. O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´ ](https://leetcode-cn.com/problems/insert-delete-getrandom-o1/)

[710. é»‘åå•ä¸­çš„éšæœºæ•°](https://leetcode-cn.com/problems/random-pick-with-blacklist/)

### <font color=#1FA774>æå‡ºæ€è·¯</font>

ç®€å•çš„æ¢³ç†ä¸€ä¸‹ï¼Œå¯¹äºã€Œåˆ é™¤ã€ã€ŒæŸ¥æ‰¾ã€ã€Œæ’å…¥ã€æ“ä½œï¼Œä¸åŒçš„æ•°æ®ç»“æ„çš„æ—¶é—´å¤æ‚åº¦

|            |  åˆ é™¤  |  æŸ¥æ‰¾  |  æ’å…¥  |
| :--------: | :----: | :----: | :----: |
|    æ•°ç»„    |  O(n)  |  O(n)  |  O(1)  |
|  æœ‰åºæ•°ç»„  |  O(n)  | O(lgn) |  O(n)  |
|    é“¾è¡¨    |  O(n)  |  O(n)  |  O(1)  |
|  æœ‰åºé“¾è¡¨  |  O(n)  |  O(n)  |  O(n)  |
| äºŒå‰æ ‘æœ€å |  O(n)  |  O(n)  |  O(n)  |
| äºŒå‰æ ‘ä¸€èˆ¬ |  O(n)  |  O(n)  |  O(n)  |
|   å¹³è¡¡æ ‘   | O(lgn) | O(lgn) | O(lgn) |
|   å“ˆå¸Œè¡¨   |  O(1)  |  O(1)  |  O(1)  |

å¦‚æœè¦å®ç°å¸¸æ•°æ—¶é—´å¤æ‚åº¦å†…çš„æ“ä½œï¼Œä»…ä»…ä½¿ç”¨å•ä¸ªæ•°æ®ç»“æ„æ»¡è¶³ä¸äº†æˆ‘ä»¬çš„éœ€æ±‚

ä¸‹é¢æä¾›ä¸€ç§æ€è·¯**<font color='red'>ã€Œå½“æˆ‘ä»¬éœ€è¦åˆ é™¤æŸä¸€ä¸ªå…ƒç´ çš„æ—¶å€™ï¼Œå¿«é€Ÿè·å–è¯¥å…ƒç´ çš„ä¸‹æ ‡ indexï¼Œç„¶åæŠŠè¯¥å…ƒç´ å’Œ List ä¸­æœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œæœ€ååˆ é™¤ List æœ€åä¸€ä¸ªå…ƒç´ å³å¯ã€</font>**

æŠŠè¦åˆ é™¤çš„å…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ï¼Œå…å»äº†ç§»åŠ¨åˆ é™¤å…ƒç´ åçš„æ‰€æœ‰å…ƒç´ 

å¦‚ä½•å¿«é€Ÿè·å¾—åˆ é™¤å…ƒç´ çš„ä¸‹æ ‡å‘¢ï¼Ÿï¼Ÿï¼Ÿ -> `Map<value, index>`

**<font color='red'>å°æŠ€å·§ï¼š</font>**å¦‚æœè¦ç­‰æ¦‚ç‡çš„éšæœºè·å–ä¸€ä¸ªå…ƒç´ ï¼Œé‚£ä¹ˆå¯è¢«é€‰æ‹©çš„å…ƒç´ å¿…é¡»æ˜¯è¿ç»­å­˜å‚¨ï¼Œç„¶åè°ƒç”¨`random.nextInt(n)`ï¼Œéšæœºç­‰æ¦‚ç‡ç”Ÿæˆ`[0, n)`å†…çš„ä¸€ä¸ªæ•°ã€‚**æ›´å¤šå…³äº`Random`çš„ç”¨æ³•å¯è§ [Random ç±»](../java/Random.html)**

### <font color=#1FA774>O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´ </font>

**é¢˜ç›®è¯¦æƒ…å¯è§ [O(1) æ—¶é—´æ’å…¥ã€åˆ é™¤å’Œè·å–éšæœºå…ƒç´ ](https://leetcode-cn.com/problems/insert-delete-getrandom-o1/)**

ç›´æ¥ç»™å‡ºè¯¦ç»†ä»£ç ï¼š(ç»“åˆæ³¨é‡Šçœ‹ ğŸ‘€)

```java
class RandomizedSet {

    List<Integer> list;
    Map<Integer, Integer> valToIndex;
    Random random;

    public RandomizedSet() {
        list = new ArrayList<>();
        valToIndex = new HashMap<>();
        random = new Random();
    }
    
    public boolean insert(int val) {
        // å¦‚æœå·²ç»å­˜åœ¨ï¼Œè¿”å›
        if (valToIndex.containsKey(val)) return false;
        list.add(val);
        // ç»´æŠ¤ val -> index çš„æ˜ å°„
        valToIndex.put(val, list.size() - 1);
        return true;
    }
    
    public boolean remove(int val) {
        // å¦‚æœä¸å­˜åœ¨ï¼Œè¿”å›
        if (!valToIndex.containsKey(val)) return false;
        // è·å¾— list ä¸­éœ€è¦åˆ é™¤çš„å…ƒç´ çš„ä¸‹æ ‡
        int index = valToIndex.get(val);
        // è·å¾—æœ€åä¸€ä¸ªå…ƒç´ 
        int last = list.get(list.size() - 1);
        // æŠŠ list ä¸­æœ€åä¸€ä¸ªå…ƒç´ å’Œéœ€è¦åˆ é™¤çš„å…ƒç´ äº¤æ¢
        list.set(index, last);
        // æ›´æ”¹äº¤æ¢å…ƒç´ çš„ä¸‹æ ‡å¯¹åº”å…³ç³»
        valToIndex.put(last, index);
        // åˆ é™¤ list æœ€åä¸€ä¸ªå…ƒç´ 
        list.remove(list.size() - 1);
        // åˆ é™¤ valToIndex key ä¸º val çš„å…ƒç´ 
        valToIndex.remove(val);
        return true;
    }
    
    public int getRandom() {
        return list.get(random.nextInt(list.size()));
    }
}
```

### <font color=#1FA774>é»‘åå•ä¸­çš„éšæœºæ•°</font>

**é¢˜ç›®è¯¦æƒ…å¯è§ [é»‘åå•ä¸­çš„éšæœºæ•°](https://leetcode-cn.com/problems/random-pick-with-blacklist/)**

å¯¹äºä¾‹å­ï¼š`n = 10, blacklist = [3, 5, 8, 9]`

æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯åˆ©ç”¨`Map`æŠŠ`blacklist`ä¸­çš„å…ƒç´ å…¨éƒ¨æ˜ å°„åˆ°æœ€åé¢å»ï¼Œå³`[0, 6)`å­˜æ”¾éé»‘åå•å†…çš„å…ƒç´ ï¼Œ`[6, 10)`å­˜æ”¾é»‘åå•å†…çš„å…ƒç´ 

éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼š**<font color='red'>æˆ‘ä»¬å¹¶éçœŸæ­£æ„ä¹‰ä¸Šçš„æŠŠå…ƒç´ ç§»åˆ°æœ€åï¼Œè€Œæ˜¯é€šè¿‡`Map`æ˜ å°„ï¼Œå…¶å®å…ƒç´ çš„ä½ç½®æ˜¯æ²¡æœ‰æ”¹å˜çš„</font>**

<img src="https://cdn.jsdelivr.net/gh/LFool/image-hosting@master/20220412/15005116497468516yAUzOimage-20220412150050973.png" alt="image-20220412150050973" style="zoom: 25%;" />

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå…ƒç´  3 å’Œ 5 åœ¨éé»‘åå•ä½ç½®ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŒ‰åºæŠŠè¿™ä¸¤ä¸ªå…ƒç´ æ˜ å°„åˆ° 7 å’Œ 6ï¼Œå³`map.put(3, 7); map.put(5, 6)`

è€Œæˆ‘ä»¬éšæœºè·å¾—éé»‘åå•å†…çš„å…ƒç´ ï¼Œç›´æ¥å¯¹åŒºé—´`[0, 6)`éšæœºå³å¯ã€‚å¦‚æœåˆšå¥½éšæœºåˆ°äº† 3 æˆ– 5ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦è¿”å›`map.get(3) = 7 or map.get(5) = 6`å³å¯

`pick()`å®ç°ä»£ç å¦‚ä¸‹ï¼š

```java
int sz = n - blacklist.length;
Random random = new Random();
public int pick() {
    int index = random.nextInt(sz);
    if (map.containsKey(index)) {
        return map.get(index);
    }
    return index;
}
```

**é‚£å¦‚ä½•æ„é€ ä¸Šè¿°çš„æ˜ å°„å‘¢ï¼Ÿï¼Ÿï¼Ÿ**

ç›´æ¥ç»™å‡ºè¯¦ç»†ä»£ç ï¼š(ç»“åˆæ³¨é‡Šçœ‹ ğŸ‘€)

```java
Map<Integer, Integer> map = new HashMap<>();
// [0, sz) å­˜æ”¾éé»‘åå•çš„å…ƒç´ 
// [sz, n) å­˜æ”¾é»‘åå•çš„å…ƒç´ 
int sz = n - blacklist.length;
public Solution(int n, int[] blacklist) {
    // é¦–å…ˆä¸ºæ¯ä¸€ä¸ªé»‘åå•å†…çš„å…ƒç´ å ä¸€ä¸ªå‘
    for (int b : blacklist) {
        map.put(b, -1);
    }
    // ä» [sz, n) çš„æœ€åä¸€ä¸ªå…ƒç´ å¼€å§‹å¾€å‰å­˜æ”¾
    int last = n - 1;
    for (int b : blacklist) {
        // b in [0, sz)
        if (b < sz) {
            // å¦‚æœåœ¨ [sz, n) ä¸­å·²ç»æœ‰é»‘åå•å†…çš„å…ƒç´ ï¼Œå³å‘å‰ç§»åŠ¨ä¸€æ­¥
            // è¿™å°±æ˜¯ä¸Šè¿°å å‘çš„ä½œç”¨
            while (map.containsKey(last)) last--;
            // æ˜ å°„
            map.put(b, last);
            last--;
        }
    }
}
```
